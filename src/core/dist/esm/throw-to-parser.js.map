{"version":3,"file":"throw-to-parser.js","sourceRoot":"","sources":["../../src/throw-to-parser.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,KAAK,EAAE,MAAM,YAAY,CAAA;AAGlC;;;;;GAKG;AACH,MAAM,CAAC,MAAM,aAAa,GAAG,CAC3B,MAAc,EACd,KAAgC,EAChC,EAAE;IACF,oEAAoE;IACpE,IAAI,CAAC,KAAK;QAAE,OAAM;IAClB,MAAM,CAAC,KAAK,CACV,UAAU,MAAM,CAAC,UAAU,CAAC,IAAI,GAAG,CAAC,MAClC,KAAK,CAAC,OAAO,IAAI,iBACnB,KAAK,KAAK,CAAC,KAAK,CAAC,EAAE,CACpB,CAAA;IACD,IAAI,MAAM,CAAC,OAAO,KAAK,CAAC,CAAC,EAAE,CAAC;QAC1B,MAAM,CAAC,KAAK,CAAC,QAAQ,MAAM,CAAC,UAAU,CAAC,IAAI,IAAI,CAAC,CAAA;IAClD,CAAC;IACD,MAAM,CAAC,GAAG,EAAE,CAAA;IACZ,OAAO,KAAK,CAAA;AACd,CAAC,CAAA","sourcesContent":["import { Parser } from 'tap-parser'\nimport { diags } from './diags.js'\nimport { Extra } from './index.js'\n\n/**\n * Provides a way for Spawn and Worker instances to handle thrown\n * errors in their TAP subtest block, rather than always having to\n * proxy their throws to the parent, since they lack any TAP generation\n * methods like TestBase.\n */\nexport const throwToParser = (\n  parser: Parser,\n  extra?: Extra | undefined | void,\n) => {\n  // if the throw was already proxied up for some reason, just give up\n  if (!extra) return\n  parser.write(\n    `not ok ${parser.pointsSeen.size + 1} - ${\n      extra.message || 'unhandled error'\n    }\\n${diags(extra)}`,\n  )\n  if (parser.planEnd === -1) {\n    parser.write(`\\n1..${parser.pointsSeen.size}\\n`)\n  }\n  parser.end()\n  return extra\n}\n"]}